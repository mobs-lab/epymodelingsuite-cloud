schemaVersion: "2.0.0"

commandTests:
  # Verify the package is installed and importable.
  - name: "import-epymodelingsuite"
    command: "python3"
    args: ["-c", "import epymodelingsuite; print('ok')"]
    expectedOutput: ["ok"]

  # Ensure runtime Python comes from the uv-managed venv.
  - name: "python-from-uv-venv"
    command: "python3"
    args:
      - "-c"
      - "import sys; assert sys.executable.startswith('/opt/epymodelingsuite/.venv/')"

  # Entrypoint script should be executable.
  - name: "dispatcher-script-executable"
    command: "test"
    args: ["-x", "/scripts/run_dispatcher.sh"]

  # Verify cloud-specific packages are importable in the venv.
  - name: "import-google-cloud-storage"
    command: "python3"
    args: ["-c", "import google.cloud.storage; print('ok')"]
    expectedOutput: ["ok"]

  - name: "import-dill"
    command: "python3"
    args: ["-c", "import dill; print('ok')"]
    expectedOutput: ["ok"]

  - name: "import-python-json-logger"
    command: "python3"
    args: ["-c", "import pythonjsonlogger; print('ok')"]
    expectedOutput: ["ok"]

fileExistenceTests:
  # Entrypoint script should exist and be executable in the image.
  - name: "dispatcher-script-present"
    path: "/scripts/run_dispatcher.sh"
    shouldExist: true
